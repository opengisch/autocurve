version: "3"


services:
  tests:
    image: opengisch/qgis:3.22.12-focal
    volumes:
      # mount the plugin
      - ./autocurve:/root/.local/share/QGIS/QGIS3/profiles/default/python/plugins/autocurve
      # include default config (enabling the plugin)
      - ./tests/QGIS3.ini:/root/.local/share/QGIS/QGIS3/profiles/default/QGIS/QGIS3.ini
      # mount the test folder
      - ./tests/tests_directory:/tests_directory
    environment:
      QT_QPA_PLATFORM: offscreen
    command: python3 /tests_directory/autocurve_tests.py

  tests_gui:
    image: opengisch/qgis:3.22.12-focal
    volumes:
      # mount the plugin
      - ./autocurve:/root/.local/share/QGIS/QGIS3/profiles/default/python/plugins/autocurve
      # include default config (enabling the plugin)
      - ./tests/QGIS3.ini:/root/.local/share/QGIS/QGIS3/profiles/default/QGIS/QGIS3.ini
      # mount the test folder
      - ./tests/tests_directory:/tests_directory
      # include initialisation script (test launcher in QGIS)
      - ./tests/startup.py:/root/.local/share/QGIS/QGIS3/startup.py
      # mount the x11 socket to forward display to host
      - /tmp/.X11-unix:/tmp/.X11-unix
    environment:
      DISPLAY: :0
    command: qgis
